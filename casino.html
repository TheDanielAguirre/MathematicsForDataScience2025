<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emoji Card Arcade ‚Äì Casino Style ‚ú® + Chips</title>
<style>
  :root{ --felt:#0a3a28; --felt-dark:#052016; --fg:#fefefe; --gold:#ffd54a; --muted:#cbd5e1; --card:#ffffff; --card-red:#e11d48; --card-black:#111827; }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:grid; place-items:center; color:var(--fg);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1200px 600px at 15% 0%, rgba(255,213,74,.12), transparent 50%),
      radial-gradient(1000px 500px at 85% 0%, rgba(255,213,74,.12), transparent 60%),
      radial-gradient(circle at top, var(--felt), var(--felt-dark) 70%);
    animation: bgPulse 10s ease-in-out infinite;
  }
  @keyframes bgPulse{ 0%,100%{ filter:saturate(1); } 50%{ filter:saturate(1.15) brightness(1.05); } }
  .app{width:min(1100px,96vw); text-align:center; position:relative}
  header{margin:22px 0; position:relative}
  h1{font-size:2rem; margin:0; color:var(--gold); text-shadow:0 2px 6px rgba(0,0,0,.7)}
  .rim{position:absolute; inset:-10px -14px auto -14px; height:8px; border-radius:999px; background:repeating-linear-gradient(90deg, rgba(255,213,74,.9) 0 18px, rgba(255,255,255,.4) 18px 24px, rgba(0,0,0,.25) 24px 26px); filter:blur(.3px); animation: marquee 2.2s linear infinite}
  @keyframes marquee{ from{background-position:0 0} to{background-position:200px 0} }
  button{ background:linear-gradient(#222,#111); color:var(--fg); border:2px solid var(--gold); padding:10px 16px; border-radius:12px; cursor:pointer; font-size:1rem; font-weight:700; position:relative; overflow:hidden; transition:transform .15s, box-shadow .15s, filter .15s; }
  button::after{content:""; position:absolute; inset:-40% -60%; transform:skewX(-25deg) translateX(-120%); background:linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent); filter:blur(1px); animation: shine 3.2s ease-in-out infinite;}
  @keyframes shine{ 0%{transform:skewX(-25deg) translateX(-120%)} 60%{transform:skewX(-25deg) translateX(120%)} 100%{transform:skewX(-25deg) translateX(120%)} }
  button:hover{ transform:translateY(-1px) scale(1.04); box-shadow:0 0 18px rgba(255,213,74,.6); }
  button:disabled{ filter:grayscale(60%); opacity:.6; cursor:not-allowed }
  .screen{display:none}
  .screen.active{display:block}
  .panel{ background:rgba(0,0,0,.52); border:3px solid var(--gold); border-radius:18px; padding:20px; margin-top:10px; box-shadow:0 0 28px rgba(0,0,0,.6), inset 0 0 28px rgba(255,213,74,.22); position:relative; overflow:hidden; }
  .panel::before{ content:""; position:absolute; inset:0; pointer-events:none; background:radial-gradient(600px 120px at -20% -20%, rgba(255,255,255,.08), transparent 60%); animation: sweep 12s linear infinite; }
  @keyframes sweep{ 0%{background-position:-20% -20%} 100%{background-position:120% 120%} }
  .panel h2{margin:0 0 6px; font-size:1.4rem; color:var(--gold)}
  .sub{margin:.25rem 0 1rem; color:var(--muted)}
  .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap; justify-content:center}
  .area{border:1px dashed rgba(255,255,255,.35); border-radius:12px; padding:12px; margin-top:10px}
  .columns{display:flex; justify-content:center; gap:10px; align-items:flex-start}
  .hud{display:flex; align-items:center; gap:8px; font-weight:800}
  .chip{display:inline-grid; place-items:center; width:28px; height:28px; border-radius:50%; background:radial-gradient(circle at 35% 35%, #fff 0 12%, #e11d48 13% 28%, #fff 29% 44%, #e11d48 45% 100%); color:#111; font-size:.9rem; box-shadow:0 2px 6px rgba(0,0,0,.5)}
  .meter{padding:6px 10px; border:1px solid rgba(255,255,255,.2); border-radius:10px; background:rgba(0,0,0,.25)}

  .card{width:66px; height:92px; border-radius:10px; background:var(--card); color:var(--card-black); display:grid; grid-template-rows:auto 1fr auto; padding:6px 7px; box-shadow:0 4px 12px rgba(0,0,0,.4); position:relative; transform-origin:center;}
  .card.red{color:var(--card-red)} .rank{font-weight:800} .suit{font-size:20px} .center{display:grid; place-items:center; font-size:28px}
  .face-down{background:linear-gradient(135deg,#1b2150,#0d1238); color:#cbd5e1; border:1px solid #4c58a5}
  .deal{animation: dealIn .28s ease-out both}
  @keyframes dealIn{ from{opacity:0; transform:translateY(-14px) scale(.96)} to{opacity:1; transform:translateY(0) scale(1)} }

  .sp-stack{position:relative; width:66px} .sp-card{position:absolute; left:0}
  .dragging{opacity:.95; box-shadow:0 10px 30px rgba(0,0,0,.7)} .drop-ok{outline:3px solid #22c55e} .drop-bad{outline:3px solid #ef4444}
  #dragGhost{position:fixed; pointer-events:none; z-index:9999} #foundations{margin-top:8px; font-weight:700}

  .decor{position:absolute; top:-12px; right:-12px; font-size:28px; filter:drop-shadow(0 3px 6px rgba(0,0,0,.5)); animation: floaty 3.8s ease-in-out infinite alternate}
  .decor.left{left:-12px; right:auto; animation-duration:4.4s}
  @keyframes floaty{ from{ transform:translateY(0) rotate(-6deg)} to{ transform:translateY(6px) rotate(8deg)} }

  .confetti{position:fixed; width:8px; height:10px; top:-10px; border-radius:2px; z-index:99999; pointer-events:none}
  .selected{outline:3px solid #e11d48; box-shadow:0 0 14px rgba(225,29,72,.55); transform:translateY(-2px) rotate(-1deg)}
  .tag{position:absolute; top:-6px; left:-6px; background:#e11d48; color:white; font-weight:800; font-size:.65rem; padding:2px 6px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.35)}
.drawer{position:fixed; top:0; right:0; height:100vh; width:min(360px,92vw); background:rgba(0,0,0,.85); border-left:3px solid var(--gold); box-shadow:-8px 0 30px rgba(0,0,0,.6); transform:translateX(100%); transition:transform .25s ease; z-index:10000; display:flex; flex-direction:column}
.drawer.open{transform:translateX(0)}
.drawer header{display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.15)}
.shop-list{padding:12px; overflow:auto; gap:10px; display:flex; flex-direction:column}
.shop-item{display:flex; align-items:center; gap:12px; padding:10px; border:1px solid rgba(255,255,255,.15); border-radius:12px; background:rgba(255,255,255,.04)}
.preview{width:44px; height:44px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.5); display:grid; place-items:center; font-size:20px}
.badge{font-size:.75rem; padding:2px 6px; border-radius:999px; background:rgba(255,213,74,.2); border:1px solid var(--gold); margin-left:auto}
.equip{margin-left:auto}
.theme-chip{display:inline-block; width:12px; height:12px; border-radius:50%; margin-left:6px}
</style>
</head>
<body>
  <div class="app">
    <header>
      <span class="rim"></span>
      <h1>üé∞ Emoji Card Arcade</h1>
    </header>

    <!-- MENU (only three buttons) -->
    <section id="menu" class="screen active">
      <div class="panel">
        <div class="decor left">üé≤</div><div class="decor">üí∞</div>
        <h2>Welcome to the Casino Floor</h2>
        <div class="row">
          <div class="hud meter"> <span class="chip">üíµ</span> Chips: <span id="bank-total">100</span> </div>
        </div>
        <div class="row" style="margin-top:6px">
          <button onclick="navigate('blackjack')">üÇ° Play Blackjack</button>
          <button onclick="navigate('poker')">‚ô¶Ô∏è Play Poker</button>
          <button onclick="navigate('solitaire')">üï∑Ô∏è Play Spider Solitaire</button>
          <button id="open-shop">üõçÔ∏è Shop</button>
        </div>
      </div>
    </section>

    <!-- BLACKJACK -->
    <section id="blackjack" class="screen">
      <div class="panel">
        <div class="decor left">üé≤</div><div class="decor">ü™ô</div>
        <div class="row" style="justify-content:space-between">
          <h2>üÇ° Blackjack</h2>
          <button onclick="navigate('menu')">Menu</button>
        </div>
        <div class="row">
          <div class="hud meter"> <span class="chip">üíµ</span> Chips: <span id="bj-chips">100</span> </div>
          <div class="hud meter"> Bet: <span id="bj-bet">0</span>
            <button id="bj-bet-5">+5</button><button id="bj-bet-25">+25</button><button id="bj-bet-max">Max</button><button id="bj-bet-clear">Clear</button>
          </div>
        </div>
        <div class="row">
          <button id="bj-new">Deal</button>
          <button id="bj-hit" disabled>Hit</button>
          <button id="bj-stand" disabled>Stand</button>
          <span class="sub" id="bj-status">Place a bet and press Deal</span>
        </div>
        <div class="area">
          <div><strong>Dealer</strong> <span id="bj-dealer-t"></span></div>
          <div id="bj-dealer" class="row"></div>
          <div><strong>You</strong> <span id="bj-player-t"></span></div>
          <div id="bj-player" class="row"></div>
        </div>
      </div>
    </section>

    <!-- POKER -->
    <section id="poker" class="screen">
      <div class="panel">
        <div class="decor left">üÉè</div><div class="decor">üíµ</div>
        <div class="row" style="justify-content:space-between">
          <h2>‚ô¶Ô∏è Poker (5‚ÄëCard Draw)</h2>
          <button onclick="navigate('menu')">Menu</button>
        </div>
        <div class="row">
          <div class="hud meter"> <span class="chip">üíµ</span> Chips: <span id="pk-chips">100</span> </div>
          <div class="hud meter"> Bet: <span id="pk-bet">0</span>
            <button id="pk-bet-5">+5</button><button id="pk-bet-25">+25</button><button id="pk-bet-max">Max</button><button id="pk-bet-clear">Clear</button>
          </div>
        </div>
        <div class="row">
          <button id="pk-deal">Deal</button>
          <button id="pk-draw" disabled>Draw</button>
          <button id="pk-show" disabled>Showdown</button>
          <span class="sub" id="pk-status">Place a bet and press Deal</span>
        </div>
        <div class="area">
          <div><strong>Dealer</strong></div>
          <div id="pk-dealer" class="row"></div>
          <div><strong>You</strong> <span class="sub">(click cards to toggle discard)</span></div>
          <div id="pk-player" class="row"></div>
        </div>
      </div>
    </section>

    <!-- SPIDER SOLITAIRE -->
    <section id="solitaire" class="screen">
      <div class="panel">
        <div class="decor left">ü™ô</div><div class="decor">‚ô†Ô∏è</div>
        <div class="row" style="justify-content:space-between">
          <h2>üï∑Ô∏è Spider Solitaire</h2>
          <button onclick="navigate('menu')">Menu</button>
        </div>
        <p class="sub">Drag sequences (face‚Äëup, descending). Only <strong>K</strong> to empty column. Deal adds one to each column. Full <strong>K‚ÜíA</strong> runs auto‚Äëclear.</p>
        <div class="row">
          <button id="sp-new">New Game</button>
          <button id="sp-deal">Deal Row</button>
          <span class="sub" id="sp-status">Loading‚Ä¶</span>
        </div>
        <div class="area">
          <div id="foundations">Completed runs: <span id="sp-done">0</span>/8</div>
          <div id="sp-columns" class="columns"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- Slide-out Shop Drawer -->
  <aside id="shop" class="drawer" aria-hidden="true">
    <header>
      <strong>üõçÔ∏è Casino Shop</strong>
      <button id="close-shop">Close</button>
    </header>
    <div class="shop-list" id="shop-list"></div>
    <div style="padding:10px; border-top:1px solid rgba(255,255,255,.15); display:flex; justify-content:space-between; align-items:center">
      <div class="hud meter"> <span class="chip">üíµ</span> Chips: <span id="shop-chips">100</span> </div>
      <small class="sub">Skins persist until refresh</small>
    </div>
  </aside>

  <div id="dragGhost" hidden></div>

<script>
/************** SHARED UTILITIES + NAV + BANK **************/
const SUITS_ALL=['‚ô†Ô∏è','‚ô•Ô∏è','‚ô¶Ô∏è','‚ô£Ô∏è'];
const VALUES_ALL=[{r:'A',v:1},{r:'2',v:2},{r:'3',v:3},{r:'4',v:4},{r:'5',v:5},{r:'6',v:6},{r:'7',v:7},{r:'8',v:8},{r:'9',v:9},{r:'10',v:10},{r:'J',v:11},{r:'Q',v:12},{r:'K',v:13}];
const isRed=s=>s==='‚ô•Ô∏è'||s==='‚ô¶Ô∏è';
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } return a; }
function makeDeck(){ const d=[]; for(const s of SUITS_ALL){ for(const {r,v} of VALUES_ALL){ d.push({s,r,v}); } } return shuffle(d); }
function el(tag,cls,text){ const e=document.createElement(tag); if(cls) e.className=cls; if(text!=null) e.textContent=text; return e; }
function cardEl(c,faceDown=false){ const d=el('div','card'+(c && isRed(c.s)?' red':'')); if(faceDown){ d.classList.add('face-down'); return d; } const t=el('div','rank',c.r||''); const s=el('div','suit',c.s||''); const mid=el('div','center',c?c.s:''); d.append(t,s,mid); d.classList.add('deal'); return d; }
function handTotalBlackjack(cards){ let sum=0,aces=0; for(const c of cards){ if(c.r==='A'){aces++; sum+=11;} else if(['K','Q','J'].includes(c.r)) sum+=10; else sum+=c.v; } while(sum>21&&aces>0){sum-=10; aces--; } return sum; }

// Navigation helpers
let chips = 100; // bankroll
function updateBankDisplays(){
  if(chips<=0){
    chips = 100;
    const el = document.getElementById('bank-total');
    if(el){ el.textContent = chips; el.animate([{transform:'scale(1)', color:'#ffd54a'},{transform:'scale(1.25)', color:'#fff'},{transform:'scale(1)', color:'#ffd54a'}], { duration:800, easing:'ease-out' }); }
  }
  const bj=document.getElementById('bj-chips');
  const pk=document.getElementById('pk-chips');
  const mt=document.getElementById('bank-total');
  const sc=document.getElementById('shop-chips');
  if(bj) bj.textContent=chips; if(pk) pk.textContent=chips; if(mt) mt.textContent=chips; if(sc) sc.textContent=chips;
}
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  const scr=document.getElementById(id);
  if(scr) scr.classList.add('active');
  updateBankDisplays();
}
function navigate(id){ showScreen(id); }

updateBankDisplays();

/************** SHOP SYSTEM **************/
const THEMES = {
  classic:{ name:'Classic Felt', cost:0, vars:{'--felt':'#0a3a28','--felt-dark':'#052016','--gold':'#ffd54a'} , icon:'üé∞'},
  royal:{ name:'Royal Purple', cost:50, vars:{'--felt':'#3b1d64','--felt-dark':'#1a0b35','--gold':'#ffdd6a'}, icon:'üëë'},
  neon:{ name:'Neon Nights', cost:50, vars:{'--felt':'#042e2c','--felt-dark':'#021716','--gold':'#66ffe0'}, icon:'üåÉ'},
  noir:{ name:'Noir', cost:50, vars:{'--felt':'#0f1115','--felt-dark':'#050607','--gold':'#cfcfcf'}, icon:'üï∂Ô∏è'}
};
const CARD_SKINS = {
  classic:{ name:'Classic Pips', cost:0, vars:{'--card-red':'#e11d48','--card-black':'#111827'}, back:'linear-gradient(135deg,#1b2150,#0d1238)' , icon:'üÇ°'},
  ruby:{ name:'Ruby & Ivory', cost:40, vars:{'--card-red':'#b91c1c','--card-black':'#2b2b2b'}, back:'linear-gradient(135deg,#6e0a1f,#420512)', icon:'‚ô¶Ô∏è'},
  cyan:{ name:'Cyan & Slate', cost:40, vars:{'--card-red':'#06b6d4','--card-black':'#0f172a'}, back:'linear-gradient(135deg,#0b3a72,#081a3a)', icon:'‚ô£Ô∏è'}
};
let ownedThemes = new Set(['classic']);
let ownedCards = new Set(['classic']);
let currentTheme = 'classic';
let currentCards = 'classic';

function applyTheme(key){
  currentTheme = key;
  const v = THEMES[key].vars; const root=document.documentElement.style;
  for(const k in v) root.setProperty(k, v[k]);
}
function applyCards(key){
  currentCards = key;
  const v = CARD_SKINS[key].vars; const root=document.documentElement.style;
  for(const k in v) root.setProperty(k, v[k]);
  // card back
  const styleTagId='card-back-style';
  let tag=document.getElementById(styleTagId);
  const css = `.face-down{background:${CARD_SKINS[key].back}; color:#cbd5e1; border:1px solid #4c58a5}`;
  if(!tag){ tag=document.createElement('style'); tag.id=styleTagId; document.head.appendChild(tag); }
  tag.textContent = css;
}

function renderShop(){
  const list = document.getElementById('shop-list');
  list.innerHTML='';
  const makeItem = (id,obj,type)=>{
    const row=document.createElement('div'); row.className='shop-item';
    const pv=document.createElement('div'); pv.className='preview'; pv.textContent = type==='theme' ? (obj.icon||'üéõÔ∏è') : 'üÇ†';
    pv.style.background = type==='theme' ? 'rgba(255,255,255,.06)' : '#fff'; pv.style.color = type==='theme' ? '#fff' : 'var(--card-black)';
    row.appendChild(pv);
    const info=document.createElement('div'); const title=document.createElement('div'); title.innerHTML = `<strong>${obj.name}</strong>`;
    const cost=document.createElement('div'); cost.className='sub'; cost.textContent = obj.cost?`Cost: ${obj.cost} chips`:'Owned';
    info.appendChild(title); info.appendChild(cost); row.appendChild(info);
    const badge=document.createElement('span'); badge.className='badge'; badge.textContent = type==='theme'?(currentTheme===id?'Equipped':'Theme'):(currentCards===id?'Equipped':'Cards'); row.appendChild(badge);
    const btn=document.createElement('button'); btn.className='equip';
    const owned = type==='theme'? ownedThemes.has(id) : ownedCards.has(id);
    btn.textContent = owned ? ( (type==='theme' && currentTheme===id) || (type!=='theme' && currentCards===id) ? 'Equipped' : 'Equip') : `Buy (${obj.cost})`;
    btn.disabled = owned && ( (type==='theme' && currentTheme===id) || (type!=='theme' && currentCards===id) );
    btn.addEventListener('click',()=>{
      const set = type==='theme'? ownedThemes : ownedCards;
      if(!set.has(id)){
        if(chips < obj.cost){ alert('Not enough chips!'); return; }
        chips -= obj.cost; set.add(id); updateBankDisplays();
      }
      if(type==='theme'){ applyTheme(id); } else { applyCards(id); }
      renderShop();
    });
    row.appendChild(btn);
    return row;
  };
  const themesHeader=document.createElement('div'); themesHeader.className='sub'; themesHeader.innerHTML = '<strong>Themes</strong>';
  list.appendChild(themesHeader);
  Object.entries(THEMES).forEach(([id,obj])=> list.appendChild(makeItem(id,obj,'theme')));
  const cardsHeader=document.createElement('div'); cardsHeader.className='sub'; cardsHeader.style.marginTop='6px'; cardsHeader.innerHTML = '<strong>Card Skins</strong>';
  list.appendChild(cardsHeader);
  Object.entries(CARD_SKINS).forEach(([id,obj])=> list.appendChild(makeItem(id,obj,'cards')));
}

const shopEl=document.getElementById('shop');
document.getElementById('open-shop').addEventListener('click', ()=>{ shopEl.classList.add('open'); renderShop(); updateBankDisplays(); shopEl.setAttribute('aria-hidden','false'); });
document.getElementById('close-shop').addEventListener('click', ()=>{ shopEl.classList.remove('open'); shopEl.setAttribute('aria-hidden','true'); });

applyTheme(currentTheme); applyCards(currentCards);
updateBankDisplays();

/* Confetti */
function confettiBurst(count=60){ const colors=['#ffd54a','#ff7aa2','#7ee787','#79c0ff','#f97316']; for(let i=0;i<count;i++){ const p=document.createElement('div'); p.className='confetti'; p.style.left=Math.random()*100+'%'; p.style.background=colors[(Math.random()*colors.length)|0]; const rot=(Math.random()*360)|0; const dur=1200+(Math.random()*1000)|0; const dx=(Math.random()*100-50); const size=6+Math.random()*6; p.style.width=size+'px'; p.style.height=(size+3)+'px'; p.style.transform=`rotate(${rot}deg)`; document.body.appendChild(p); p.animate([{ transform:`translateY(-10px) rotate(${rot}deg)`, opacity:1 },{ transform:`translate(${dx}px, 110vh) rotate(${rot+360}deg)`, opacity:.9 }], { duration:dur, easing:'cubic-bezier(.2,.7,.2,1)'}).onfinish=()=>p.remove(); } }

/************** BLACKJACK + BETTING **************/
(function(){
  const dealerDiv=document.getElementById('bj-dealer');
  const playerDiv=document.getElementById('bj-player');
  const sDealer=document.getElementById('bj-dealer-t');
  const sPlayer=document.getElementById('bj-player-t');
  const status=document.getElementById('bj-status');
  const btnNew=document.getElementById('bj-new');
  const btnHit=document.getElementById('bj-hit');
  const btnStand=document.getElementById('bj-stand');
  const bjChips=document.getElementById('bj-chips');
  const betEl=document.getElementById('bj-bet');
  const add5=document.getElementById('bj-bet-5');
  const add25=document.getElementById('bj-bet-25');
  const addMax=document.getElementById('bj-bet-max');
  const clr=document.getElementById('bj-bet-clear');
  let deck=[], dealer=[], player=[], hidden=true, over=true, bet=0;

  function setButtons(active){ btnHit.disabled=!active; btnStand.disabled=!active; }
  function render(){ dealerDiv.innerHTML=''; playerDiv.innerHTML=''; dealer.forEach((c,i)=> dealerDiv.appendChild(i===0 && hidden? cardEl({}, true): cardEl(c)) ); player.forEach(c=> playerDiv.appendChild(cardEl(c)) ); sPlayer.textContent = player.length? `(${handTotalBlackjack(player)})`:''; sDealer.textContent = hidden? '': dealer.length? `(${handTotalBlackjack(dealer)})`:''; bjChips.textContent=chips; betEl.textContent=bet; }
  function end(msg, winType=null){ over=true; hidden=false; render(); status.textContent=msg; setButtons(false);
    if(winType==='blackjack'){ chips += Math.round(bet*2.5); confettiBurst(80); }
    else if(winType==='win'){ chips += bet*2; confettiBurst(70); }
    else if(winType==='push'){ chips += bet; }
    bet=0; updateBankDisplays(); betEl.textContent=bet; }

  function ensureBet(){ if(bet<=0){ status.textContent='Place a bet first.'; return false; } if(bet>chips){ status.textContent='Bet exceeds chips.'; return false; } return true; }

  function deal(){ if(!ensureBet()) return; deck=makeDeck(); dealer=[]; player=[]; hidden=true; over=false; status.textContent=''; setButtons(true);
    chips -= bet; updateBankDisplays();
    player.push(deck.pop(), deck.pop()); dealer.push(deck.pop(), deck.pop()); render();
    const p=handTotalBlackjack(player), d=handTotalBlackjack(dealer);
    if(p===21){ if(d===21) end('Both blackjack ‚Äî Push.', 'push'); else end('Blackjack! 3:2 payout.', 'blackjack'); }
  }
  function hit(){ if(over||!deck.length) return; player.push(deck.pop()); render(); const p=handTotalBlackjack(player); if(p>21) end('Bust! Dealer wins.'); }
  function stand(){ if(over) return; hidden=false; render(); while(handTotalBlackjack(dealer)<17){ dealer.push(deck.pop()); render(); }
    const p=handTotalBlackjack(player), d=handTotalBlackjack(dealer);
    if(d>21) end('Dealer busts! You win.', 'win'); else if(p>d) end('You win!', 'win'); else if(p<d) end('Dealer wins.'); else end('Push (tie).', 'push'); }

  btnNew.onclick=deal; btnHit.onclick=hit; btnStand.onclick=stand;
  add5.onclick=()=>{ if(over){ bet=Math.min(bet+5, chips); render(); } };
  add25.onclick=()=>{ if(over){ bet=Math.min(bet+25, chips); render(); } };
  addMax.onclick=()=>{ if(over){ bet=chips; render(); } };
  clr.onclick=()=>{ if(over){ bet=0; render(); } };
})();

/************** POKER ‚Äì 5 Card Draw + BETTING **************/
(function(){
  const dealerDiv=document.getElementById('pk-dealer');
  const playerDiv=document.getElementById('pk-player');
  const status=document.getElementById('pk-status');
  const btnDeal=document.getElementById('pk-deal');
  const btnDraw=document.getElementById('pk-draw');
  const btnShow=document.getElementById('pk-show');
  const pkChips=document.getElementById('pk-chips');
  const betEl=document.getElementById('pk-bet');
  const add5=document.getElementById('pk-bet-5');
  const add25=document.getElementById('pk-bet-25');
  const addMax=document.getElementById('pk-bet-max');
  const clr=document.getElementById('pk-bet-clear');
  let deck=[], dealer=[], player=[], discards=new Set(), phase='idle', bet=0, anteTaken=false;

  function setPhase(p){ phase=p; btnDraw.disabled=!(phase==='deal'); btnShow.disabled=!(phase==='draw'); }
  function render(){ dealerDiv.innerHTML=''; playerDiv.innerHTML=''; pkChips.textContent=chips; betEl.textContent=bet;
    if(phase==='deal' || phase==='draw') dealer.forEach(()=> dealerDiv.appendChild(cardEl({}, true))); else dealer.forEach(c=> dealerDiv.appendChild(cardEl(c)));
    player.forEach((c,i)=>{ const e=cardEl(c); if(phase==='deal'){ e.classList.add('clickable'); e.addEventListener('click',()=>{ if(discards.has(i)) discards.delete(i); else if(discards.size<3) discards.add(i); render(); }); if(discards.has(i)){ e.classList.add('selected'); const badge=document.createElement('span'); badge.className='tag'; badge.textContent='DISCARD'; e.appendChild(badge); } } playerDiv.appendChild(e); });
    if(phase==='deal') status.textContent = `Select ${discards.size}/3 to discard, then press Draw.`;
  }
  function ensureBet(){ if(bet<=0){ status.textContent='Place a bet first.'; return false; } if(bet>chips){ status.textContent='Bet exceeds chips.'; return false; } return true; }
  function deal(){ if(!ensureBet()) return; deck=makeDeck(); dealer=[]; player=[]; discards.clear(); setPhase('deal'); status.textContent='Select up to 3 to discard, then Draw.'; for(let i=0;i<5;i++){ player.push(deck.pop()); dealer.push(deck.pop()); } if(!anteTaken){ chips -= bet; anteTaken=true; updateBankDisplays(); } render(); }
  function draw(){ if(phase!=='deal') return; setPhase('draw'); const keep=[]; player.forEach((c,i)=>{ if(!discards.has(i)) keep.push(c); }); while(keep.length<5) keep.push(deck.pop()); player=keep; discards.clear(); status.textContent='Showdown time!'; render(); }
  function showdown(){ if(phase==='idle') return; setPhase('show'); const dKeep=new Set(); const cnt={}; dealer.forEach(c=>cnt[c.r]=(cnt[c.r]||0)+1); dealer.forEach((c,i)=>{ if(cnt[c.r]>1) dKeep.add(i); }); const newD=[]; dealer.forEach((c,i)=>{ if(dKeep.has(i)) newD.push(c); }); while(newD.length<5) newD.push(deck.pop()); dealer=newD; render(); const pr=evaluate(player), dr=evaluate(dealer); const cmp=compareHands(pr,dr); if(cmp>0){ chips += bet*2; confettiBurst(80); status.textContent=`You: ${pr.name} vs Dealer: ${dr.name}. You win!`; } else if(cmp<0){ status.textContent=`You: ${pr.name} vs Dealer: ${dr.name}. Dealer wins.`; } else { chips += bet; status.textContent=`You: ${pr.name} vs Dealer: ${dr.name}. Tie.`; } bet=0; anteTaken=false; updateBankDisplays(); render(); }
  btnDeal.onclick=deal; btnDraw.onclick=draw; btnShow.onclick=showdown;
  add5.onclick=()=>{ if(phase==='idle'){ bet=Math.min(bet+5, chips); render(); } };
  add25.onclick=()=>{ if(phase==='idle'){ bet=Math.min(bet+25, chips); render(); } };
  addMax.onclick=()=>{ if(phase==='idle'){ bet=chips; render(); } };
  clr.onclick=()=>{ if(phase==='idle'){ bet=0; render(); } };

  function evaluate(h){ const ranks=h.map(c=>c.v===1?14:c.v).sort((a,b)=>b-a); const suits=h.map(c=>c.s); const isFlush=suits.every(s=>s===suits[0]); const sorted=[...ranks].sort((a,b)=>a-b); let straight=sorted.every((v,i)=> i===0 || v===sorted[i-1]+1); if(JSON.stringify(sorted)==='[2,3,4,5,14]'){ straight=true; sorted[4]=5; sorted.sort((a,b)=>a-b); } const counts={}; ranks.forEach(v=>counts[v]=(counts[v]||0)+1); const groups=Object.entries(counts).sort((a,b)=> b[1]-a[1] || b[0]-a[0]).map(([v,c])=>({v:+v,c})); let rank=0,name='High Card',tb=ranks; if(straight&&isFlush){rank=8;name='Straight Flush';tb=[sorted[4]];} else if(groups[0].c===4){rank=7;name='Four of a Kind';tb=[groups[0].v,groups[1].v];} else if(groups[0].c===3&&groups[1].c===2){rank=6;name='Full House';tb=[groups[0].v,groups[1].v];} else if(isFlush){rank=5;name='Flush';tb=ranks;} else if(straight){rank=4;name='Straight';tb=[sorted[4]];} else if(groups[0].c===3){rank=3;name='Three of a Kind';tb=[groups[0].v,...kickers(groups.slice(1),2)];} else if(groups[0].c===2&&groups[1]&&groups[1].c===2){rank=2;name='Two Pair';tb=[Math.max(groups[0].v,groups[1].v),Math.min(groups[0].v,groups[1].v),...kickers(groups.slice(2),1)];} else if(groups[0].c===2){rank=1;name='One Pair';tb=[groups[0].v,...kickers(groups.slice(1),3)];} return {rank,name,tiebreak:tb}; }
  function kickers(gs,n){ const out=[]; for(const g of gs){ for(let i=0;i<g.c;i++){ out.push(g.v); if(out.length===n) return out; } } return out; }
  function compareHands(a,b){ if(a.rank!==b.rank) return a.rank>b.rank?1:-1; for(let i=0;i<Math.max(a.tiebreak.length,b.tiebreak.length);i++){ const x=a.tiebreak[i]||0, y=b.tiebreak[i]||0; if(x!==y) return x>y?1:-1; } return 0; }
})();

/************** SPIDER SOLITAIRE (1‚Äësuit) **************/
(function(){
  const colDiv=document.getElementById('sp-columns');
  const status=document.getElementById('sp-status');
  const doneEl=document.getElementById('sp-done');
  const btnNew=document.getElementById('sp-new');
  const btnDeal=document.getElementById('sp-deal');
  const SPREAD=20; let deck=[], columns=[], done=0; let drag={active:false, fromCol:null, fromIndex:null, run:[], ghost:null, offsetX:0, offsetY:0};
  function makeSpiderDeck(){ const d=[]; for(let i=0;i<8;i++){ for(const {r,v} of VALUES_ALL){ d.push({r,s:'‚ô†Ô∏è',v,faceDown:false}); } } return shuffle(d); }
  function newGame(){ deck=makeSpiderDeck(); columns=Array.from({length:10},()=>[]); done=0; doneEl.textContent='0'; for(let c=0;c<10;c++){ for(let r=0;r<5;r++){ const card=deck.pop(); card.faceDown=(r<4); columns[c].push(card); } } render(); status.textContent='Game started. Build sequences King‚ÜíAce.'; }
  function dealRow(){ if(columns.some(col=>col.length===0)){ status.textContent='Fill empty columns before dealing a new row.'; return; } if(deck.length<10){ status.textContent='No more rows.'; return; } for(let c=0;c<10;c++){ const card=deck.pop(); card.faceDown=false; columns[c].push(card); } render(); }
  function render(){ colDiv.innerHTML=''; columns.forEach((col,ci)=>{ const st=el('div','sp-stack'); st.dataset.col=ci; col.forEach((card,i)=>{ const e=cardEl(card, card.faceDown); e.classList.add('sp-card'); e.style.top=(i*SPREAD)+'px'; e.dataset.col=ci; e.dataset.index=i; if(!card.faceDown){ e.classList.add('clickable'); e.addEventListener('pointerdown', startDrag); } st.appendChild(e); }); st.style.height = (col.length? ((col.length-1)*SPREAD + 92): 92)+'px'; st.addEventListener('pointerup', endDragOnColumn); colDiv.appendChild(st); }); scanAutoClear(); }
  function startDrag(ev){ const cardElmt=ev.currentTarget; const col=+cardElmt.dataset.col; const idx=+cardElmt.dataset.index; const colArr=columns[col]; if(colArr[idx].faceDown) return; const run=[]; for(let i=idx;i<colArr.length;i++){ const c=colArr[i]; if(c.faceDown){ break; } if(i>idx){ const prev=colArr[i-1]; if(prev.v!==c.v+1){ break; } } run.push(c); } if(run.length===0) return; drag.active=true; drag.fromCol=col; drag.fromIndex=idx; drag.run=run; const ghost = document.getElementById('dragGhost'); ghost.innerHTML=''; ghost.hidden=false; drag.ghost=ghost; run.forEach((c,i)=>{ const e=cardEl(c,false); e.classList.add('dragging'); e.style.position='absolute'; e.style.left='0px'; e.style.top=(i*SPREAD)+'px'; ghost.appendChild(e); }); const rect=cardElmt.getBoundingClientRect(); drag.offsetX = ev.clientX - rect.left; drag.offsetY = ev.clientY - rect.top; moveGhost(ev.clientX, ev.clientY); window.addEventListener('pointermove', onPointerMove); window.addEventListener('pointerup', endDragAnywhere, {once:true}); }
  function onPointerMove(ev){ moveGhost(ev.clientX, ev.clientY); highlightDrop(ev.clientX, ev.clientY); }
  function moveGhost(x,y){ if(!drag.ghost) return; drag.ghost.style.left=(x-drag.offsetX)+'px'; drag.ghost.style.top=(y-drag.offsetY)+'px'; }
  function highlightDrop(x,y){ document.querySelectorAll('.sp-stack').forEach(s=>s.classList.remove('drop-ok','drop-bad')); const target=columnFromPoint(x,y); if(!target) return; const ok=canDrop(target); target.classList.add(ok?'drop-ok':'drop-bad'); }
  function endDragAnywhere(ev){ const target=columnFromPoint(ev.clientX, ev.clientY); if(target && canDrop(target)){ performDrop(target); } cleanupDrag(); }
  function endDragOnColumn(ev){ if(!drag.active) return; const target=ev.currentTarget; if(canDrop(target)){ performDrop(target); } cleanupDrag(); }
  function cleanupDrag(){ document.querySelectorAll('.sp-stack').forEach(s=>s.classList.remove('drop-ok','drop-bad')); if(drag.ghost){ drag.ghost.hidden=true; drag.ghost.innerHTML=''; } drag={active:false, fromCol:null, fromIndex:null, run:[], ghost:null, offsetX:0, offsetY:0}; render(); }
  function columnFromPoint(x,y){ const el=document.elementFromPoint(x,y); if(!el) return null; return el.closest('.sp-stack'); }
  function canDrop(stackEl){ const toCol=+stackEl.dataset.col; const col=columns[toCol]; if(drag.run.length===0) return false; const movingTop=drag.run[0]; if(col.length===0) return movingTop.r==='K'; const targetTop = topFaceUp(col); if(!targetTop) return false; return targetTop.v===movingTop.v+1; }
  function topFaceUp(col){ for(let i=col.length-1;i>=0;i--){ if(!col[i].faceDown) return col[i]; } return null; }
  function performDrop(stackEl){ const toCol=+stackEl.dataset.col; const fromCol=drag.fromCol; const src=columns[fromCol]; const dst=columns[toCol]; const moved=src.splice(drag.fromIndex, drag.run.length); dst.push(...moved); const newTop=src[src.length-1]; if(newTop && newTop.faceDown) newTop.faceDown=false; status.textContent=`Moved ${moved.length} card(s).`; scanAutoClear(); }
  function scanAutoClear(){ for(let ci=0;ci<columns.length;ci++){ const col=columns[ci]; if(col.length<13) continue; let ok=true; let start=col.length-13; for(let i=0;i<13;i++){ const c=col[start+i]; if(c.faceDown){ ok=false; break; } if(i>0){ const prev=col[start+i-1]; if(prev.v!==c.v+1){ ok=false; break; } } } if(ok && col[start].r==='K' && col[start+12].r==='A'){ col.splice(start,13); done++; doneEl.textContent=String(done); status.textContent=`Cleared a run! (${done}/8)`; confettiBurst(60); const newTop=col[col.length-1]; if(newTop && newTop.faceDown) newTop.faceDown=false; } } }
  btnNew.onclick=newGame; btnDeal.onclick=dealRow; newGame();
})();
</script>
</body>
</html>
